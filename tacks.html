<!DOCTYPE html>
<html lang="en-UK">
<head>
	<meta charset="utf-8"/>
	<title>Tacks</title>
	<meta name="viewport" content="width=device-width"/>
<style>
:root{
	--white: #171717;
	--black: #f5f1ec;
	--whiteAccent: #DDD;
	--ascii: #f5f1ec;
	--feature: coral;
}
.light{
	--black: #171717;
	--white: #f5f1ec;
	--whiteAccent: #DDD;
	--ascii: #5c5b59;
	--feature: coral;
}
.dark{
	--white: #171717;
	--black: #f5f1ec;
	--whiteAccent: #DDD;
	--ascii: #f5f1ec;
	--feature: coral;
}
body{
	width: 99%;
	text-align: center;
	align-content: center;
	background-color: var(--white);
	color: var(--black);
	font-family:monospace;
}
.dark-mode{
	background-color: var(--black);
	color: var(--white);
}
h1 {
	text-align: center;
	color: var(--black);
}
h1.title{
	text-align: center;
	color:  vaR(--black);
	font-size: 48px;
	margin: 0px;
}
h2 {
	font-size: 24px;
	margin: 8px;
	color: var(--black);
}
button{
	font-size: 16px;
	padding: 8px;
	margin: 4px;
	color: var(--white);
	background-color: var(--black);
	transition-duration: 0.2s;
	font-family: monospace;
	font-weight: bold;
}
button:hover{
	background-color: var(--feature);

}
label{
	font-size: 32px;
	color: var(--black);
	padding: 12px;
	font-family: monospace;
}
label.small{
	font-size: 16px;
	padding: 2px;
}
footer {
	position: fixed;
	left: 0;
	bottom: 0;
	width: 100%;
	text-align: center;
	align-content: center;
}
div.widget{
	background-color: var(--white);
	border: solid 1px var(--black);
	min-width: 250px;
	width: fit-content;
	padding: 12px;
	margin: 12px;
	border-radius: 4px;
	text-align: center;
}
#ascii{
  max-width: 100vw;
  overflow-x: hidden;
  position: absolute;
  top: -20px;
  left: 0;
  color: var(--ascii);
}
.notification{
	color: var(--white);
	padding: 10px;
	font-family: monospace;
	transition-duration: 0.2s;
	z-index: -1;
	width: fit-content;
}
.notification.show{
	opacity: 0.9;
}
.notification.hide{
	opacity: 0;
}
.slice{
	width: 100vw;
	height: fit-content;
	padding: 12px;
	align-items: center;
	align-content: center;
	display: flex;
	flex-direction: column;
}
</style>
</head>
<! ========================================================================= >
<body>
	<pre id="ascii" style=" z-index: -1;"></pre>
	<div style="display: flex; flex-direction: column; align-items: center; width: 100%;">
		<div style="background-color: var(--white); z-index: 2; display: flex; flex-direction: column; align-items: center; border: solid 1px var(--black);
					width: fit-content; padding-left: 80px; padding-right: 80px; padding-top: 16px; padding-bottom: 16px;; margin-top: 64px; align-content: center;">
			<h1 class="title">Tacks</h1>
			<p style="color: var(--black); margin-top: 0px;">A Lesser Paperclips</p>
		</div>
		
	</div>
	<div style="display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 72px">
		<div class="widget">
			<p style="text-align:center" id="tpsLbl">Click to increment.</p>

			<label id="lbl">0</label>
			<br>
			<button id="btn">Boop</button>
		</div>
	</div>
	<h2> Upgrades & Automation</h2>
	<div style="display: flex; flex-direction: column; align-items: center; width: 100%">
		<div style="width: fit-content">
			<div id="fingerSlice" class="slice" style="background-color: blue;">
				<div class="widget">
					<button id="fingerBtn">Buy Extra Finger</button>
					<div>
						<label class="small">+0.25 per click</label> <br>
						<label class="small">Cost: 20</label>
						<br>
						<label class="small">Owned:<label class="small" id="fingerLbl">0</label></label>
					</div>
				</div>
			</div>
			<div id="workerSlice" class="slice" style="background-color: darkgreen;">
				<div class="widget">
					<button id="workerBtn">Buy Worker</button>
					<div>
						<label class="small">+0.4 per second</label><br>
						<label class="small">Cost: 100</label>
						<br>
						<label class="small">Owned:<label class="small" id="workerLbl">0</label></label>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div style="position: absolute; right: 20px; bottom: 80px; text-align: right;">
		<label class="small"; id="dateTimeLbl">DateTime</label>
		<br>
		<label class="small"; id="upTimeLbl">UpTime</label>
		<br>
		<label class="small"; id="playedTimeLbl">PlayedTime</label>
		<br>
		<p>Add more debug stuff.</p>
	</div>
	<div style="position:absolute; bottom: 40px; left: 80px;">
		<h2>Preferences</h2>
		<button id="toggleDark">Toggle Dark Mode</button><br>
		<button id="saveGame">Save</button>
	</div>
	<div id="notificationContainer" style="position: absolute; z-index: -1; display: flex; bottom: 80px; text-align: center; align-items: center; width: 99%; flex-direction: column-reverse;">
	</div>
<footer>
	Â© Ryan Appleyard MMXXV
</footer>


</body>

<! ========================================================================= >

<script>

const DATA = {
	tacks: 0,
	fingerAmount: 0,
	workerAmount: 0,
	playedTime: 0
}

// Light and Dark refer to the themes they are paired with.
const COLOURS = {
	green: {
		light: "#3C983E",
		dark: "#6FD08C"
	},
	red: "#FC5130",
	text: {
		light: "#111111",
		dark: "#FFFFFF"
	}
}

let TPS = 0;
const FPS = 1000 / 32;
const tpsLbl = document.getElementById("tpsLbl");

let upTime = 0;
// let minutes;
// let hours;

let startTime = Date.now();
const upTimeLbl = document.getElementById("upTimeLbl");
const dateTimeLbl = document.getElementById("dateTimeLbl");
const playedTimeLbl = document.getElementById("playedTimeLbl");
const notifCont = document.getElementById("notificationContainer");

let AutoValue = {
	FINGER: 0.25,
	WORKER: 0.4
};

let AutoPrice = {
	FINGER: 20,
	WORKER: 100
}

const saveData = {
	version: "1.0.0",
	resources: {
		tacks: DATA.tacks,
		fingers: DATA.fingerAmount,
		workers: DATA.workerAmount,
		playedTime: DATA.playedTime
	},
	//add whatever else.
	lastSave: Date.now()
}


function SaveGame(){
	localStorage.setItem("tacksSave", JSON.stringify(DATA));
	PrintNotification("Saved Game", COLOURS.green);
}

function AutosaveGame(){
	SaveGame();
	PrintNotification("Autosaved", COLOURS.green, 2000);
}

function LoadGame(){
	const saveData = localStorage.getItem("tacksSave");
	if(saveData){
		let parsed = JSON.parse(saveData);
		DATA.tacks = parsed.tacks || 0;
		DATA.fingerAmount = parsed.fingerAmount || 0;
		DATA.workerAmount = parsed.workerAmount || 0;
		DATA.playedTime = parsed.playedTime || 0;
	}else{
		return;
	}
}

LoadGame();
Init();
Automation();

document.getElementById("btn").addEventListener("click", context=>{
Increment((DATA.fingerAmount * AutoValue.FINGER) + 1);
});

document.getElementById("fingerBtn").addEventListener("click", context=>{
if(Buy("finger", 1, AutoPrice.FINGER)) DATA.fingerAmount++;
});

document.getElementById("workerBtn").addEventListener("click", context=>{
if(Buy("worker", 1, AutoPrice.WORKER)) DATA.workerAmount++;
});

document.getElementById("toggleDark").addEventListener("click", function(){
	var element = document.body;
	element.classList.toggle("light");
});

document.getElementById("saveGame").addEventListener("click", function(){
	SaveGame();
})

setInterval(Automation, 1000);
setInterval(Display, FPS);
setInterval(AutosaveGame, 600000);

function Init(){
	IncrementSpecific(DATA.workerAmount, "worker");
	IncrementSpecific(DATA.fingerAmount, "finger");

	// Calculate compounding price changes.
}

function Increment(amount){
	DATA.tacks += amount;
}

function IncrementSpecific(amount, name){
	var label = document.getElementById(name + "Lbl");
	currentNo = parseFloat(label.textContent) + amount;
	label.textContent = Math.floor(currentNo);
}

function Decrement(amount){
	DATA.tacks -= amount;
}

function CanAfford(price){
	return true ? price <= parseInt(DATA.tacks, 10) : false;
}

function Buy(type, amount, price){
	if(CanAfford(price)){
		Decrement(price);
		IncrementSpecific(amount, type);
		PrintNotification("Bought: " + amount + "x " + type, COLOURS.text, 2000);
		return true;
	}
	else{
		PrintNotification("Can't afford another " + type, COLOURS.red, 2000);
		return false;
	}		
}

// Called once per second
function Automation(){
	CalculateTPS();
	tpsLbl.textContent = "Tacks p/s: " + TPS.toFixed(2);
	dateTimeLbl.textContent = new Date().toLocaleString();
	upTime++;
	var upTimeElapsed = ConvertTime(upTime);
	upTimeLbl.textContent = "Up Time: " + upTimeElapsed;
	DATA.playedTime++;
	var playedTimeElapsed = ConvertTime(DATA.playedTime)
	playedTimeLbl.textContent = "Played Time: " + playedTimeElapsed;
}

// Called 24 times per second
function Display(){
	Increment(TPS / FPS);
	lbl.textContent = NumberWithCommas(Math.floor(DATA.tacks));
}

function CalculateTPS(){
	TPS = AutoValue.WORKER * DATA.workerAmount;
}

function ConvertTime(timeIn){
	const hours = Math.floor(timeIn / 3600);
	const minutes = Math.floor((timeIn % 36000) / 60);
	const seconds = timeIn % 60;

	return hours + "h " + minutes + "m " + seconds + "s";
}

function PrintNotification(message, color, duration = 3000){
	const note = document.createElement("div");
	note.className = "notification";
	note.textContent = message;
	note.style.color = getColor(color);

	notifCont.appendChild(note);

	setTimeout(() =>{
		note.classList.remove("show");
		note.classList.add("hide");
		setTimeout(() => note.remove(), 500);
	}, duration);
}

function getColor(type) {
    if (typeof type === "string") return type;
    return isLightMode() ? type.light : type.dark;
}

function isLightMode() {
    return document.body.classList.contains("light");
}

function NumberWithCommas(x) {
    x = x.toString();
    var pattern = /(-?\d+)(\d{3})/;
    while (pattern.test(x))
        x = x.replace(pattern, "$1,$2");
    return x;
}

// ========================================================= PERLIN

const perm = new Uint8Array(512);
for (let i = 0; i < 256; i++) perm[i] = i;
for (let i = 255; i > 0; i--) {
  const j = Math.floor(Math.random() * (i + 1));
  [perm[i], perm[j]] = [perm[j], perm[i]];
}
for (let i = 0; i < 256; i++) perm[i + 256] = perm[i];

function fade(t) {
  return t * t * t * (t * (t * 6 - 15) + 10);
}

function lerp(a, b, t) {
  return a + t * (b - a);
}

function grad(hash, x, y, z) {
  const h = hash & 15;
  const u = h < 8 ? x : y;
  const v = h < 4 ? y : h === 12 || h === 14 ? x : z;
  return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);
}

function perlin(x, y, z) {
  const X = Math.floor(x) & 255;
  const Y = Math.floor(y) & 255;
  const Z = Math.floor(z) & 255;

  x -= Math.floor(x);
  y -= Math.floor(y);
  z -= Math.floor(z);

  const u = fade(x);
  const v = fade(y);
  const w = fade(z);

  const A  = perm[X] + Y, AA = perm[A] + Z, AB = perm[A + 1] + Z;
  const B  = perm[X + 1] + Y, BA = perm[B] + Z, BB = perm[B + 1] + Z;

  return lerp(
    lerp(
      lerp(grad(perm[AA], x, y, z),
           grad(perm[BA], x - 1, y, z), u),
      lerp(grad(perm[AB], x, y - 1, z),
           grad(perm[BB], x - 1, y - 1, z), u), v),
    lerp(
      lerp(grad(perm[AA + 1], x, y, z - 1),
           grad(perm[BA + 1], x - 1, y, z - 1), u),
      lerp(grad(perm[AB + 1], x, y - 1, z - 1),
           grad(perm[BB + 1], x - 1, y - 1, z - 1), u), v),
    w
  );
}

// const chars = " '   .,-*=##$&@";
const chars = "   .oO0@ ";
const userScreen = document.getElementById("ascii");
let t = 0;
let paused = false;

function mapValueToChar(val) {
  const normalized = (val + 1) / 2;
  const index = Math.floor(normalized * (chars.length - 1));
  return chars[index];
}

function renderFrame() {
    if (!paused) {
        let output = "";
        const width = screen.width;
        const height = 18;

    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const value = perlin(x * 0.1, y * 0.1, t);
        output += mapValueToChar(value);
      }
      output += "\n";
    }

    userScreen.textContent = output;
    t += 0.01;
  }
}

document.addEventListener("keydown", (e) => {
  if (e.code === "Space") paused = !paused;
});

setInterval(renderFrame, FPS);

</script>
</html>
























